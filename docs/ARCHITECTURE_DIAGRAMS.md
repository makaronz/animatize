> [!NOTE]
> This document contains broader or historical analysis.
> For the current runtime design and active routes use **docs/ARCHITECTURE.md** and **docs/API.md**.

# ANIMAtiZE Architecture Visual Diagrams

## 1. System Architecture Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ANIMAtiZE FRAMEWORK                                 â”‚
â”‚                        Cinematic Movement Pipeline                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚  Image File  â”‚
                              â”‚  (JPEG/PNG)  â”‚
                              â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘   SCENE ANALYZER       â•‘
                        â•‘   (scene_analyzer.py)  â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                â–¼                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Objects   â”‚  â”‚    Depth    â”‚  â”‚ Composition â”‚
            â”‚  Detection  â”‚  â”‚ Estimation  â”‚  â”‚  Analysis   â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚  Analysis Cache     â”‚
                          â”‚  (In-Memory Dict)   â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘  MOVEMENT PREDICTOR    â•‘
                        â•‘ (movement_predictor.py)â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                â–¼                â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚  Character   â”‚  â”‚   Camera     â”‚  â”‚ Environment  â”‚
          â”‚  Movement    â”‚  â”‚  Movement    â”‚  â”‚   Motion     â”‚
          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Movement Rules      â”‚
                          â”‚ (47+ Rules JSON)    â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                                     â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘   PROMPT EXPANDER      â•‘
                        â•‘  (prompt_expander.py)  â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â–¼                 â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ LRU Cache   â”‚    â”‚  OpenAI     â”‚
                    â”‚ (128 items) â”‚    â”‚  GPT-4      â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                   â”‚ Expanded Prompt     â”‚
                                   â”‚ (Cinematic Text)    â”‚
                                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                        â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                        â•‘   IMAGE GENERATOR          â•‘
                        â•‘   (image_generator.py)     â•‘
                        â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                â–¼                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Flux    â”‚     â”‚  Imagen  â”‚     â”‚  DALL-E  â”‚
            â”‚   API    â”‚     â”‚   API    â”‚     â”‚   API    â”‚
            â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ File Cache      â”‚
                          â”‚ (MD5-based PNG) â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                   â”‚
                                   â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ Generated Image â”‚
                          â”‚  + Metadata     â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 2. Data Flow Pipeline

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATA FLOW ANALYSIS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INPUT: image_path (str)
   â”‚
   â”œâ”€â†’ PIL.Image.open()
   â”‚   â””â”€â†’ RGB Image Object
   â”‚
   â””â”€â†’ cv2.imread()
       â””â”€â†’ NumPy Array [H, W, 3] uint8 BGR
           â”‚
           â”œâ”€â†’ cv2.cvtColor(BGR2HSV)
           â”‚   â””â”€â†’ HSV Array [H, W, 3]
           â”‚       â””â”€â†’ Color Segmentation
           â”‚           â””â”€â†’ Object Masks
           â”‚
           â”œâ”€â†’ cv2.cvtColor(BGR2GRAY)
           â”‚   â””â”€â†’ Grayscale [H, W] uint8
           â”‚       â”œâ”€â†’ cv2.Sobel() â†’ Gradients
           â”‚       â”‚   â””â”€â†’ Depth Map [H, W] float32
           â”‚       â”‚
           â”‚       â”œâ”€â†’ cv2.Canny() â†’ Edges
           â”‚       â”‚   â””â”€â†’ Edge Map [H, W] bool
           â”‚       â”‚       â””â”€â†’ cv2.HoughLinesP()
           â”‚       â”‚           â””â”€â†’ Leading Lines
           â”‚       â”‚
           â”‚       â””â”€â†’ Symmetry Analysis
           â”‚           â””â”€â†’ Symmetry Score float
           â”‚
           â””â”€â†’ Analysis Results Dict
               â”‚
               â”œâ”€ image_info: {width, height, aspect_ratio, brightness}
               â”œâ”€ objects: [{class, confidence, bbox, center, area}, ...]
               â”œâ”€ depth: {min, max, mean, variance, complexity}
               â”œâ”€ composition: {rule_of_thirds, symmetry, complexity}
               â”œâ”€ scene_type: {type, confidence, color_ratios}
               â””â”€ aesthetics: {overall, composition, depth, color}
                   â”‚
                   â””â”€â†’ Movement Predictions
                       â”‚
                       â”œâ”€ character_actions: [{pose, action, justification}, ...]
                       â”œâ”€ camera_movements: [{type, direction, justification}, ...]
                       â””â”€ environment_animations: [{element, motion}, ...]
                           â”‚
                           â””â”€â†’ Generated Prompts List[str]
                               â”‚
                               â””â”€â†’ Prompt Expansion Request
                                   â”‚
                                   â”œâ”€ base_prompt: str
                                   â”œâ”€ rules: List[Dict]
                                   â””â”€ context: Dict
                                       â”‚
                                       â””â”€â†’ OpenAI GPT-4 API
                                           â”‚
                                           â”œâ”€ System Prompt (templates)
                                           â””â”€ User Prompt (combined)
                                               â”‚
                                               â””â”€â†’ Expanded Prompt str
                                                   â”‚
                                                   â””â”€â†’ Image Generation Request
                                                       â”‚
                                                       â”œâ”€ prompt: str
                                                       â”œâ”€ api: ImageAPI
                                                       â”œâ”€ dimensions: (w, h)
                                                       â””â”€ parameters: {...}
                                                           â”‚
                                                           â””â”€â†’ Generated Image bytes
                                                               â”‚
OUTPUT: {image_data, metadata, quality_score, generation_time}
```

## 3. Control Flow & Routing

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     CONTROL FLOW DIAGRAM                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

main.py
  â”‚
  â””â”€â†’ ANIMAtiZEFramework()
      â”‚
      â”œâ”€â†’ initialize()
      â”‚   â”œâ”€â†’ Load configs
      â”‚   â”œâ”€â†’ Init analyzers
      â”‚   â””â”€â†’ Init API clients
      â”‚
      â””â”€â†’ process_image(path)
          â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         VALIDATION LAYER                â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚  â”‚ âœ— No schema validation         â”‚     â”‚
          â”‚  â”‚ âœ— No file size checks          â”‚     â”‚
          â”‚  â”‚ âœ— No format validation         â”‚     â”‚
          â”‚  â”‚ âœ“ Basic null checks            â”‚     â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚          CACHING LAYER                  â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚  â”‚ Scene: In-Memory Dict          â”‚     â”‚
          â”‚  â”‚ Prompt: LRU (128, 1hr TTL)     â”‚     â”‚
          â”‚  â”‚ Image: Filesystem (MD5 key)    â”‚     â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚        PROCESSING PIPELINE              â”‚
          â”‚                                         â”‚
          â”‚  [1] SceneAnalyzer                      â”‚
          â”‚      â”œâ”€ Check cache                     â”‚
          â”‚      â”œâ”€ Load image (PIL + CV)           â”‚
          â”‚      â”œâ”€ Parallel analysis:              â”‚
          â”‚      â”‚   â”œâ”€ Objects                     â”‚
          â”‚      â”‚   â”œâ”€ Depth                       â”‚
          â”‚      â”‚   â”œâ”€ Composition                 â”‚
          â”‚      â”‚   â””â”€ Scene type                  â”‚
          â”‚      â””â”€ Return Dict                     â”‚
          â”‚          â”‚                               â”‚
          â”‚  [2] MovementPredictor                  â”‚
          â”‚      â”œâ”€ Analyze characters              â”‚
          â”‚      â”œâ”€ Analyze camera                  â”‚
          â”‚      â”œâ”€ Analyze environment             â”‚
          â”‚      â””â”€ Generate prompts                â”‚
          â”‚          â”‚                               â”‚
          â”‚  [3] PromptExpander                     â”‚
          â”‚      â”œâ”€ Check LRU cache                 â”‚
          â”‚      â”œâ”€ Build system prompt             â”‚
          â”‚      â”œâ”€ Build user prompt               â”‚
          â”‚      â”œâ”€ Call OpenAI API                 â”‚
          â”‚      â”‚   â”œâ”€ Retry on RateLimitError     â”‚
          â”‚      â”‚   â””â”€ Timeout 30s                 â”‚
          â”‚      â”œâ”€ Calculate confidence            â”‚
          â”‚      â””â”€ Cache result                    â”‚
          â”‚          â”‚                               â”‚
          â”‚  [4] ImageGenerator                     â”‚
          â”‚      â”œâ”€ Check file cache (MD5)          â”‚
          â”‚      â”œâ”€ Select API (Flux/Imagen/DALL-E) â”‚
          â”‚      â”œâ”€ Async API call                  â”‚
          â”‚      â”œâ”€ Assess quality                  â”‚
          â”‚      â””â”€ Cache to file                   â”‚
          â”‚                                         â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚         ERROR HANDLING                  â”‚
          â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
          â”‚  â”‚ Generic try/except blocks      â”‚     â”‚
          â”‚  â”‚ Logging to console             â”‚     â”‚
          â”‚  â”‚ Return error dicts             â”‚     â”‚
          â”‚  â”‚ âœ— No structured errors         â”‚     â”‚
          â”‚  â”‚ âœ— No retry except OpenAI       â”‚     â”‚
          â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
       Return Result
```

## 4. Cache Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CACHE ARCHITECTURE                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   SCENE ANALYZER CACHE                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Type:       In-Memory Dictionary                            â”‚
â”‚  Key:        image_path (str)                                â”‚
â”‚  Value:      Complete analysis dict                          â”‚
â”‚  Eviction:   âš ï¸  NONE (unbounded)                            â”‚
â”‚  TTL:        âš ï¸  NONE (until restart)                        â”‚
â”‚  Size Limit: âš ï¸  NONE                                        â”‚
â”‚  Thread-safe: âŒ NO                                           â”‚
â”‚                                                               â”‚
â”‚  Risk:       Memory leak with batch processing               â”‚
â”‚  Fix:        Implement LRU with maxsize                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PROMPT EXPANDER CACHE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Type:       In-Memory Dictionary + LRU Decorator            â”‚
â”‚  Key:        MD5(prompt + rules + context)                   â”‚
â”‚  Value:      ExpansionResult object                          â”‚
â”‚  Eviction:   âœ… LRU (128 items)                              â”‚
â”‚  TTL:        âœ… 3600 seconds (1 hour)                        â”‚
â”‚  Size Limit: âœ… 128 items                                    â”‚
â”‚  Thread-safe: âŒ NO                                           â”‚
â”‚                                                               â”‚
â”‚  Performance:                                                 â”‚
â”‚    Cache Hit:  ~0ms (memory lookup)                          â”‚
â”‚    Cache Miss: 500-3000ms (OpenAI API)                       â”‚
â”‚                                                               â”‚
â”‚  Hit Rate:     Unknown (no telemetry)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   IMAGE GENERATOR CACHE                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Type:       Filesystem (PNG files)                          â”‚
â”‚  Key:        MD5(prompt+api+dims+quality+seed+guidance)      â”‚
â”‚  Value:      PNG image file                                  â”‚
â”‚  Location:   data/cache/images/{cache_key}.png               â”‚
â”‚  Eviction:   âš ï¸  NONE (manual cleanup)                       â”‚
â”‚  TTL:        âš ï¸  NONE (persistent)                           â”‚
â”‚  Size Limit: âš ï¸  NONE                                        â”‚
â”‚  Persistence: âœ… YES (survives restarts)                      â”‚
â”‚                                                               â”‚
â”‚  Performance:                                                 â”‚
â”‚    Cache Hit:  ~50-100ms (file I/O)                          â”‚
â”‚    Cache Miss: 5000-30000ms (API call)                       â”‚
â”‚                                                               â”‚
â”‚  Risk:        Disk space exhaustion                          â”‚
â”‚  Fix:         Implement LRU + TTL cleanup                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CACHE EFFECTIVENESS MATRIX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module         â”‚ Hit Rate â”‚ Miss     â”‚ Eviction â”‚ Telemetry â”‚
â”‚                â”‚          â”‚ Penalty  â”‚          â”‚           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SceneAnalyzer  â”‚ Unknown  â”‚ 50-200ms â”‚ None     â”‚ None      â”‚
â”‚ PromptExpander â”‚ Unknown  â”‚ 0.5-3s   â”‚ LRU+TTL  â”‚ None      â”‚
â”‚ ImageGenerator â”‚ Unknown  â”‚ 5-30s    â”‚ None     â”‚ None      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## 5. Bottleneck Hotspots

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     BOTTLENECK HEATMAP                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LATENCY DISTRIBUTION (per image):

SceneAnalyzer           â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  50-200ms    (1%)
                        â”œâ”€ Objects: 20-50ms
                        â”œâ”€ Depth: 15-30ms
                        â”œâ”€ Composition: 10-20ms
                        â””â”€ Scene Type: 5-10ms

MovementPredictor       â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  100-300ms   (1%)
                        â”œâ”€ Character: 30-80ms
                        â”œâ”€ Camera: 40-100ms
                        â””â”€ Environment: 30-120ms

PromptExpander          â–“â–“â–“â–“â–“â–“â–“â–“â–“â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  500-3000ms  (10%)
  [CRITICAL BOTTLENECK] â”œâ”€ Cache check: <1ms
                        â”œâ”€ Prompt build: 5-10ms
                        â””â”€ OpenAI API: 490-2990ms âš ï¸
                            â”œâ”€ Network: 50-200ms
                            â”œâ”€ Processing: 400-2500ms
                            â””â”€ Retry logic: +0-6000ms

ImageGenerator          â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“â–“  5-30s       (88%)
  [MAJOR BOTTLENECK]    â”œâ”€ Cache check: 50-100ms
                        â””â”€ API calls:
                            â”œâ”€ DALL-E: 5-30s âš ï¸
                            â”œâ”€ Flux: 3-20s âš ï¸
                            â””â”€ Imagen: 4-40s âš ï¸

TOTAL PIPELINE: 5.65s - 33.5s per image

PRIORITY TARGETS:
1. ğŸ”´ ImageGenerator API calls (88% of time)
2. ğŸŸ  PromptExpander OpenAI calls (10% of time)
3. ğŸŸ¢ SceneAnalyzer + MovementPredictor (2% of time)
```

## 6. Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MEMORY USAGE PROFILE                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

HEAP ALLOCATION:

SceneAnalyzer
â”œâ”€ analysis_cache: Dict[str, Dict]
â”‚  â””â”€ âš ï¸  UNBOUNDED - Memory leak risk
â”‚      Est: 50KB per image Ã— N images
â”‚      Example: 1000 images = 50MB
â”‚
PromptExpander
â”œâ”€ cache: Dict[str, Tuple[float, ExpansionResult]]
â”‚  â””â”€ âœ… LRU (128 items) + TTL (1hr)
â”‚      Max: ~10KB per item Ã— 128 = 1.28MB
â”‚
â””â”€ @lru_cache(maxsize=128) decorator
   â””â”€ Additional ~1.28MB

ImageGenerator
â””â”€ No in-memory cache (filesystem-based)

IMAGE BUFFERS (transient):
â”œâ”€ PIL Image: W Ã— H Ã— 3 Ã— 1 byte (RGB uint8)
â”‚  Example: 1920Ã—1080Ã—3 = 6.2MB
â”‚
â”œâ”€ OpenCV Image: W Ã— H Ã— 3 Ã— 1 byte (BGR uint8)
â”‚  Example: 1920Ã—1080Ã—3 = 6.2MB
â”‚
â”œâ”€ HSV Image: W Ã— H Ã— 3 Ã— 1 byte
â”‚  Example: 1920Ã—1080Ã—3 = 6.2MB
â”‚
â”œâ”€ Grayscale: W Ã— H Ã— 1 byte
â”‚  Example: 1920Ã—1080 = 2.0MB
â”‚
â””â”€ Depth Map: W Ã— H Ã— 4 bytes (float32)
   Example: 1920Ã—1080Ã—4 = 8.3MB

TOTAL PER IMAGE PROCESSING:
â”œâ”€ Buffers: ~29MB (1080p)
â”œâ”€ Cache entries: ~50KB
â””â”€ Peak: ~30MB per image

BATCH PROCESSING (N images):
â”œâ”€ SceneAnalyzer cache: 50KB Ã— N âš ï¸
â”œâ”€ Buffers: 30MB Ã— 1 (reused)
â””â”€ Total: 30MB + (50KB Ã— N)

MEMORY LEAK SCENARIOS:
1. Process 10,000 images â†’ 500MB cache
2. Long-running service â†’ Unbounded growth
3. Concurrent processing â†’ N Ã— 30MB buffers
```

## 7. Concurrency Model

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CONCURRENCY ANALYSIS                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

CURRENT STATE:

SceneAnalyzer
  â””â”€ SEQUENTIAL
      â”œâ”€ _get_image_info()
      â”œâ”€ _detect_objects_fallback()
      â”œâ”€ _estimate_depth_fallback()
      â”œâ”€ _analyze_composition()
      â”œâ”€ _classify_scene()
      â””â”€ _calculate_aesthetics_score()
          âš ï¸  Could be parallelized with ThreadPoolExecutor

MovementPredictor
  â””â”€ SEQUENTIAL
      â”œâ”€ _analyze_character_movement()
      â”œâ”€ _analyze_camera_movement()
      â””â”€ _analyze_environmental_motion()
          âš ï¸  Could be parallelized

PromptExpander
  â””â”€ SEQUENTIAL (per request)
      â””â”€ OpenAI API call
          âš ï¸  No batching support

ImageGenerator
  â””â”€ âœ… ASYNC/AWAIT
      â”œâ”€ generate_image() â†’ asyncio coroutine
      â””â”€ generate_batch() â†’ asyncio.gather()
          â”œâ”€ Semaphore(max_concurrent=3)
          â””â”€ Parallel API calls âœ…

IMPROVEMENT OPPORTUNITIES:

1. SceneAnalyzer Parallelization:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ ThreadPoolExecutor(max_workers=4)   â”‚
   â”‚  â”œâ”€ Future: objects                 â”‚
   â”‚  â”œâ”€ Future: depth                   â”‚
   â”‚  â”œâ”€ Future: composition             â”‚
   â”‚  â””â”€ Future: scene_type              â”‚
   â”‚                                     â”‚
   â”‚ await futures.as_completed()        â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Est. speedup: 2-3x

2. Batch Processing Pipeline:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Process Pool (N workers)            â”‚
   â”‚  â”‚                                  â”‚
   â”‚  â”œâ”€ Worker 1: image_1               â”‚
   â”‚  â”œâ”€ Worker 2: image_2               â”‚
   â”‚  â”œâ”€ Worker 3: image_3               â”‚
   â”‚  â””â”€ Worker N: image_N               â”‚
   â”‚                                     â”‚
   â”‚ Collect results                     â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Est. speedup: NÃ—

3. Prompt Batching:
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Accumulate requests (up to 20)      â”‚
   â”‚ Send batch to OpenAI API            â”‚
   â”‚ Distribute responses                â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
   Est. cost reduction: 50%
```

## 8. Error Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      ERROR HANDLING FLOW                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SceneAnalyzer.analyze_image()
  â”‚
  â”œâ”€ ValueError (cv_image is None)
  â”‚   â””â”€â†’ Log error
  â”‚       â””â”€â†’ Return _get_error_analysis(str(e))
  â”‚
  â””â”€ Generic Exception
      â””â”€â†’ Log error
          â””â”€â†’ Return _get_error_analysis(str(e))
              â””â”€â†’ {"error": True, "error_message": str, "timestamp": str}

MovementPredictor.analyze_image()
  â”‚
  â””â”€ Generic Exception
      â””â”€â†’ Log error
          â””â”€â†’ Return {"error": str(e)}

PromptExpander.expand_prompt()
  â”‚
  â”œâ”€ ValueError (no API key)
  â”‚   â””â”€â†’ Raise immediately (no retry)
  â”‚
  â”œâ”€ openai.RateLimitError
  â”‚   â””â”€â†’ Retry with exponential backoff
  â”‚       â”œâ”€ Attempt 1: wait 1s
  â”‚       â”œâ”€ Attempt 2: wait 2s
  â”‚       â””â”€ Attempt 3: wait 4s â†’ Raise if fails
  â”‚
  â”œâ”€ openai.APIError
  â”‚   â””â”€â†’ Retry once (1s delay) â†’ Raise if fails
  â”‚
  â””â”€ Generic Exception
      â””â”€â†’ Log error â†’ Raise

ImageGenerator.generate_image()
  â”‚
  â”œâ”€ ValueError (no API key)
  â”‚   â””â”€â†’ Raise immediately
  â”‚
  â””â”€ Generic Exception during API call
      â””â”€â†’ Log error â†’ Raise
          â””â”€â†’ âš ï¸  No retry logic
          â””â”€â†’ âš ï¸  No fallback to other APIs

ERROR HANDLING QUALITY MATRIX:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Module         â”‚ Retry   â”‚ Fallb. â”‚ Struct.  â”‚ Observ.  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ SceneAnalyzer  â”‚ âŒ No   â”‚ âŒ No  â”‚ âŒ Dict  â”‚ âš ï¸  Logs â”‚
â”‚ MovementPred.  â”‚ âŒ No   â”‚ âŒ No  â”‚ âŒ Dict  â”‚ âš ï¸  Logs â”‚
â”‚ PromptExpander â”‚ âœ… Yes  â”‚ âŒ No  â”‚ âŒ Raise â”‚ âš ï¸  Logs â”‚
â”‚ ImageGenerator â”‚ âŒ No   â”‚ âŒ No  â”‚ âŒ Raise â”‚ âš ï¸  Logs â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

MISSING:
- Structured error types (custom exceptions)
- Error tracking (Sentry integration)
- Error metrics (failure rate, error types)
- Circuit breaker pattern
- Degraded mode (partial results)
```

---

**Visual Diagrams Complete**
